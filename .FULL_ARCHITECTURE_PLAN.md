**Project: ClaudeCloud - Hosted Autonomous Claude Code Instances (microSaaS)**

**Overall Goal**: Build a zero-trust, auto-scaling, persistent Claude Code hosting platform. Users get their own isolated instance with background-running Claude (dangerously-approve-all), persistent projects via volumes, and future polished UIs. Revenue model: $19–29/mo base + usage.

**Provider Abstraction**: The control plane uses a `Provisioner` interface so the compute backend is swappable via config (`PROVIDER=docker|hetzner`). Local Docker is the default for development and MVP testing (zero cloud spend). Hetzner + Netbird is the production backend. Both providers are built out in Phase 1–2; the feature toggle selects which one is active.

**Jira-Style Planning Structure**
- **Phases**: High-level milestones (4–8 weeks each, depending on solo/full-time).
- **Epics**: Major deliverables within a phase (1–2 weeks).
- **Features**: Atomic, shippable units.
- **Tasks**: Checklist with owner (you), effort (S/M/L), dependencies, and acceptance criteria.

---

### **Phase 1: Foundations & Infrastructure (Week 1–2)**
*Goal*: Get provider abstraction, local Docker MVP, and Hetzner integrations ready. Docker works end-to-end first.

#### **Epic 1.1: Provider Abstraction & Local Docker (MVP)**
**Feature 1.1.1: Provisioner Interface**
- [x] Define Go `Provisioner` interface: `Create(ctx, UserID) (Instance, error)`, `Destroy(ctx, InstanceID)`, `Status(ctx, InstanceID)`, `Pause(ctx, InstanceID)`, `Wake(ctx, InstanceID)`
- [x] `Instance` struct: ID, UserID, Provider ("docker"|"hetzner"), Host, Port, Status, VolumeID
- [x] Config: `PROVIDER` env var selects active backend (default: `docker`)
- [x] Provider registry: `NewProvisioner(cfg) Provisioner` factory
*Effort: M | Owner: You*

**Feature 1.1.2: Docker Provider**
- [x] Implement `Provisioner` for local Docker (via Docker SDK for Go)
- [x] `Create`: spin up container from `claude-instance` image, bind-mount named volume to `/claude-data`
- [x] Dockerfile for `claude-instance`: Ubuntu base, Claude Code installed, zellij, mosh-server
- [x] Container gets `dangerously-approve-all` in `~/.config/claude/settings.json`
- [x] Start detached Zellij session on container boot (entrypoint script)
- [x] Docker network `claude-net` for inter-container connectivity (bridge mode)
- [x] `Pause`/`Wake`: `docker stop`/`docker start` (volume persists)
- [x] `Destroy`: remove container, optionally remove volume
- [ ] Test: `Create` → container running, `docker exec` into Zellij session works
*Effort: L | Owner: You*

**Feature 1.1.3: Docker Compose Dev Stack**
- [x] `docker-compose.yml`: Postgres + control plane API + one test claude-instance
- [x] `.env.example` with `PROVIDER=docker` and Postgres DSN
- [x] `make dev` target to bring up full local stack
- [ ] Test: `curl POST /instances` → new container appears in `docker ps`
*Effort: S | Owner: You | Depends: 1.1.1, 1.1.2*

#### **Epic 1.2: Hetzner & Netbird Provider (Production Backend)**
**Feature 1.2.1: Hetzner Cloud & Terraform Workspace**
- [ ] Create new Hetzner project "claude-cloud-prod" (separate from personal)
- [ ] Generate API token (read/write) and store in 1Password
- [x] Set up Terraform workspace (GitHub repo: `claude-cloud-infra`) with `.tfvars` for secrets
- [x] Configure providers: `hcloud` (v1.48+), `netbird` (if official), `random`, `time`
- [ ] Test: `terraform apply` creates a dummy CX11 (acceptance: server appears in console)
*Effort: M | Owner: You*

**Feature 1.2.2: Netbird Cloud Organization**
- [ ] Create Netbird Cloud account (if not already)
- [ ] Set up organization "claude-cloud"
- [ ] Invite yourself as Owner
- [ ] Generate admin Setup Key (never expires, used only by control plane)
- [ ] Create initial "proxy-router" group and device (manual for now)
- [ ] Export API token (store securely)
*Effort: S | Owner: You*

**Feature 1.2.3: Shared Private Network (Terraform)**
- [x] Terraform: `hcloud_network` → `claude-private-net` (CIDR `10.100.0.0/16`)
- [ ] Terraform: Central proxy router (CX11, name `claude-proxy`, public IPv4, attached to private net at `10.100.0.1`)
- [ ] Cloud-init for proxy: install Netbird, `netbird up --setup-key $ADMIN_KEY --hostname proxy-router`
- [ ] Mark proxy as routing peer via Netbird API (POST /api/routes with `is_lan=true`)
*Effort: M | Owner: You | Depends: 1.2.2*

**Feature 1.2.4: Hetzner Provider**
- [x] Implement `Provisioner` for Hetzner (via `terraform-exec` or direct hcloud Go SDK)
- [x] `Create`: Terraform module `modules/user_instance` (server, volume, attachment, no public IP)
- [x] Dynamic subnet assignment: `10.100.${user_id % 250 + 1}.10` (round-robin)
- [x] Cloud-init template with Netbird setup + Claude Code install
- [x] `Pause`: snapshot server, destroy server (volume remains)
- [x] `Wake`: recreate from snapshot, re-attach volume
- [ ] Test: `Create` with `PROVIDER=hetzner` → server appears in Hetzner console
*Effort: L | Owner: You | Depends: 1.2.3*

#### **Epic 1.3: Control Plane Skeleton**
**Feature 1.3.1: Backend Repo & DB**
- [x] New repo: `claude-cloud-backend` (Go)
- [x] Docker + Postgres (local for dev, Railway or Hetzner CX11 for prod)
- [x] Ent schema: User, Subscription, Instance (provider, host, port, volume_id, status)
- [x] Auth: Clerk or Supabase Auth (email + magic link)
*Effort: L | Owner: You*

**Feature 1.3.2: Instance API**
- [x] `POST /instances` → calls active `Provisioner.Create()`
- [x] `DELETE /instances/:id` → calls `Provisioner.Destroy()`
- [x] `POST /instances/:id/pause` → calls `Provisioner.Pause()`
- [x] `POST /instances/:id/wake` → calls `Provisioner.Wake()`
- [x] `GET /instances/:id` → calls `Provisioner.Status()`
- [x] All endpoints are provider-agnostic (same API whether Docker or Hetzner)
*Effort: M | Owner: You | Depends: 1.1.1, 1.3.1*

---

### **Phase 2: Core Provisioning & Zero-Trust (Week 3–4)**
*Goal*: Fully automated user → instance flow on both providers. CLI-only access works.

#### **Epic 2.1: Netbird Integration Layer (Hetzner provider only)**
**Feature 2.1.1: Dynamic ACL & Route Management**
- [x] Netbird Go client wrapper (thin REST wrapper in `internal/netbird/`)
- [x] On user signup (when `PROVIDER=hetzner`):
  - Create Group `user-${user_id}`
  - Create one-time Setup Key (expires 1h, auto-joins group)
  - Create Route: `10.100.${subnet}.0/24` via proxy peer
  - Create Policy: Source=group, Dest=route, Action=accept
- [x] Cron job: cleanup expired keys (`CronService` with 30min interval)
- [x] Skip all Netbird steps when `PROVIDER=docker` (containers are directly reachable)
*Effort: M | Owner: You*

**Feature 2.1.2: User Connect Script**
- [x] `/connect.sh` endpoint (returns bash script, provider-aware)
- [x] Docker mode: `docker exec -it claude-{user_id} zellij attach claude`
- [x] Hetzner mode: install Netbird + `netbird up` + `mosh claude@10.100.x.10`
*Effort: S | Owner: You*

#### **Epic 2.2: Instance Bootstrap**
**Feature 2.2.1: Claude Code + Persistent Session (shared logic)**
- [x] Shared setup script (`scripts/instance/setup.sh`) used by both Dockerfile and cloud-init
  - Install/verify mosh, zellij, Node.js, Claude Code
  - Set `dangerouslyApproveAll` in `~/.config/claude/settings.json`
  - Start detached Zellij session `claude` with layout: 70% Claude, 30% shell
- [x] Volume mount: `/claude-data` (Docker named volume or Hetzner block volume)
- [x] Docker-specific: expose mosh UDP ports 60000-60010
- [x] Hetzner-specific: UFW rules for mosh + Netbird WireGuard only
*Effort: M | Owner: You*

**Feature 2.2.2: Inactivity Detection via Polling**
- [x] `ActivityService`: polls running instances at configurable interval (default 5m)
- [x] Docker mode: `ContainerTop` — active if processes > 3
- [x] Hetzner mode: server running status check
- [x] Auto-pause instances idle > threshold (default 2h)
- [x] `last_activity_at` field on Instance schema for tracking
*Effort: M | Owner: You*

---

### **Phase 3: MVP Dashboard & Billing (Week 5–6)**
*Goal*: Users can sign up, pay, get access, wake/pause.

#### **Epic 3.1: Stripe + User Portal**
**Feature 3.1.1: Subscription Flow**
- [x] Stripe products: Base ($19/mo, 20h included), Usage ($0.08/h)
- [x] Webhook: on payment → create user record + trigger instance provisioning
- [x] Portal: Next.js app showing "My Claude" status (Running / Paused)
*Effort: L | Owner: You*

**Feature 3.1.2: "Wake My Claude" Button**
- [x] Calls `Provisioner.Wake()` / `Provisioner.Status()` — provider-agnostic
- [x] Docker: `docker start` container (volume persists)
- [x] Hetzner: recreate from snapshot, re-attach volume, re-apply Netbird route/policy
- [x] If running: just show connection details
*Effort: M | Owner: You*

#### **Epic 3.2: CLI Experience Polish**
**Feature 3.2.1: One-Command Connect**
- [x] `claude-cloud connect` (downloads Netbird config, opens mosh)
- [ ] Desktop alias script for Mac/Windows
*Effort: S | Owner: You*

---

### **Phase 4: UI Layer & Multi-Platform (Week 7–9)**
*Goal*: No terminal required for 80% of users.

#### **Epic 4.1: Web Terminal, Chat UI & Projects**
**Feature 4.1.1: Instance Agent + ttyd**
- [x] ttyd web terminal running on each instance (port 7681)
- [x] Node.js instance agent (port 3001) with chat, files, projects endpoints
- [x] Per-instance agent_secret for auth, stored in DB
- [x] Activity threshold bumped from >3 to >6 processes
*Effort: L | Owner: You*

**Feature 4.1.2: Go API Proxy**
- [x] WebSocket proxy for terminal (ttyd) and chat (agent)
- [x] HTTP reverse proxy for files/projects endpoints
- [x] JWT auth + instance ownership verification on all proxy routes
- [x] GET /instances/mine endpoint for current user's instance
- [x] API container joins claude-net for Docker container access
*Effort: M | Owner: You*

**Feature 4.1.3: Dashboard Terminal Page**
- [x] xterm.js terminal with ttyd binary protocol handling
- [x] Connection status indicator, reconnect button, auto-fit
- [x] Navigation tabs: Overview | Terminal | Chat | Projects
*Effort: M | Owner: You*

**Feature 4.1.4: Dashboard Chat Page**
- [x] WebSocket streaming chat with Claude via Agent SDK
- [x] Markdown rendering with syntax-highlighted code blocks
- [x] Collapsible tool use/result activity display
- [x] File browser sidebar with directory navigation and file preview
- [x] Working directory support via ?cwd= query param
*Effort: L | Owner: You*

**Feature 4.1.5: Dashboard Projects Page**
- [x] List git repos from instance filesystem
- [x] Clone repo form (URL + branch)
- [x] "Open in Chat" and "Open in Terminal" buttons per project
*Effort: S | Owner: You*

#### **Epic 4.2: Desktop & Mobile Apps**
**Feature 4.2.1: Tauri Desktop**
- [ ] Electron/Tauri app: embeds Netbird, webview for dashboard, native mosh
- [ ] Auto-update via GitHub
*Effort: L | Owner: You or contractor*

**Feature 4.2.2: Mobile (React Native)**
- [ ] iOS/Android: same as desktop but read-only + notifications ("Claude finished task")
*Effort: L | Owner: Contractor*

---

### **Phase 5: Reliability, Security & Launch (Week 10–12)**
*Goal*: Ship to first 50 paying users.

#### **Epic 5.1: Monitoring & Auto-Recover**
**Feature 5.1.1: Full Observability**
- [ ] UptimeRobot + Netbird metrics → Slack alerts
- [ ] Auto-recreate on crash (volume snapshot restore)
- [ ] Usage tracking: Anthropic spend proxy (optional)
*Effort: M | Owner: You*

**Feature 5.1.2: Security Audit**
- [ ] Hetzner firewall rules (only proxy)
- [ ] Netbird ACLs: deny-all default
- [ ] Secrets: age-encrypted in Terraform
- [ ] Penetration test (self or bugcrowd)
*Effort: M | Owner: You*

#### **Epic 5.2: Launch**
**Feature 5.2.1: Landing Page & Marketing**
- [ ] Framer/Next.js site: "Your personal AI dev that never sleeps"
- [ ] Waitlist → Stripe checkout
- [ ] Launch on Product Hunt, IndieHackers, X
*Effort: M | Owner: You*

---

### **Phase 6: Scale & Monetization 2.0 (Month 4+)**
*Goal*: 500+ users, GPU support, white-label.

#### **Epic 6.1: Multi-Region & HA**
**Feature 6.1.1: Multiple Private Nets**
- [ ] Auto-spawn new network + proxy when >80 users
- [ ] Netbird multi-router support
*Effort: L*

#### **Epic 6.2: Advanced Features**
**Feature 6.2.1: GPU Instances**
- [ ] Option: CX52 with A100 (extra $2/h)
*Effort: M*

**Feature 6.2.2: Team Plans**
- [ ] Shared projects across users (ACLs at Netbird level)
*Effort: M*

**Feature 6.2.3: API for Agents**
- [ ] Expose Claude via MCP over Netbird
*Effort: L*
